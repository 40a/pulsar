<!DOCTYPE html>



<html>
<head>
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

    <title>Benchmarking &mdash; pulsar 0.9.3-beta.1 documentation</title>
    
    <link rel="stylesheet" href="../static/pulsar.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.3-beta.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <link rel="shortcut icon" href="../static/favicon.ico"/>
    <link rel="top" title="pulsar 0.9.3-beta.1 documentation" href="../index.html" />
    <link rel="up" title="Tutorials &amp; Topics" href="index.html" />
    <link rel="next" title="C Extensions" href="cextensions.html" />
    <link rel="prev" title="Synchronous Components" href="sync.html" /> 
</head>
 <body>



    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="cextensions.html" title="C Extensions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="sync.html" title="Synchronous Components"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">pulsar 0.9.3-beta.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Tutorials &amp; Topics</a> &raquo;</li> 
      </ul>
    </div>
<div class="deck">
<div class="header">
    
        <p class="developmentversion">
        Documentation for pulsar's DEVELOPMENT version. Get the
        <a href="http://pythonhosted.org/pulsar/tutorials/benchmarking.html">release docs here</a>.
        </p>
    
</div>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="benchmarking">
<h1>Benchmarking<a class="headerlink" href="#benchmarking" title="Permalink to this headline">¶</a></h1>
<div class="section" id="test-concurrency">
<h2>Test Concurrency<a class="headerlink" href="#test-concurrency" title="Permalink to this headline">¶</a></h2>
<p>The simpliest way to benchmark pulsar is to use the <a class="reference internal" href="httpbin.html#tutorials-httpbin"><em>HttpBin</em></a>
example application. It is a web server responding to several urls:</p>
<div class="highlight-python"><div class="highlight"><pre>python manage.py -b :9060
</pre></div>
</div>
<div class="section" id="test-streaming">
<h3>Test streaming<a class="headerlink" href="#test-streaming" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">stream</span></tt> url simulates a streaming response of chunks of length given by the
first url parameter repeated by the second url parameter.</p>
<p>For example, this measure the download speed when streaming chunks of 4KB 1,048,576 times
for a total of 4GB of data:</p>
<div class="highlight-python"><div class="highlight"><pre>curl http://localhost:9060/stream/4096/1048576 &gt; /dev/null
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 4096M    0 4096M    0     0  87.8M      0 --:--:--  0:00:46 --:--:-- 73.1M
</pre></div>
</div>
<p>The download speed is relatively slow considering the test is on localhost.
However, when switching the two numbers:</p>
<div class="highlight-python"><div class="highlight"><pre>curl http://localhost:9060/stream/1048576/4096 &gt; /dev/null
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 4096M    0 4096M    0     0   658M      0 --:--:--  0:00:06 --:--:--  673M
</pre></div>
</div>
<p>We have a download speed almost 10 times higher. Why?</p>
<p>Because the iterator send large chunks to pulsar and the buffering is handled
by asyncio rather than the iterator and therefore it is much more efficient.
In other words the bigger the chunks the faster the transfer rate and
the more responsive (in term of concurrent connections) the server will be.</p>
</div>
<div class="section" id="benchmark-with-jmeter">
<h3>Benchmark with JMeter<a class="headerlink" href="#benchmark-with-jmeter" title="Permalink to this headline">¶</a></h3>
<p>Install <a class="reference external" href="http://jmeter.apache.org/">jmeter</a>, on a mac simply use <tt class="docutils literal"><span class="pre">homebrew</span></tt></p>
<blockquote>
<div>brew install jmeter</div></blockquote>
<p>launch it, open the <tt class="docutils literal"><span class="pre">httpbin.jmx</span></tt> benchmark file and run it.</p>
</div>
</div>
<div class="section" id="test-slow-clients">
<h2>Test slow clients<a class="headerlink" href="#test-slow-clients" title="Permalink to this headline">¶</a></h2>
<p>Testing pulsar with <a class="reference external" href="http://ha.ckers.org/slowloris/">slowloris</a> is a great way to check the performance under
low bandwidth yet greedy clients.</p>
<p>check the file limits with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ulimit</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
<p>and set:</p>
<div class="highlight-python"><div class="highlight"><pre>ulimit -n 1000
</pre></div>
</div>
<p>Check <a class="reference external" href="http://ha.ckers.org/slowloris/">slowloris</a> usage with:</p>
<div class="highlight-python"><div class="highlight"><pre>perldoc slowloris.pl
</pre></div>
</div>
<p>To test for slow bandwidth greedy clients:</p>
<div class="highlight-python"><div class="highlight"><pre>./slowloris.pl -dns www.example.com -port 80 -timeout 30 -num 1000
</pre></div>
</div>
</div>
<div class="section" id="pulsar-store-versus-redis">
<h2>Pulsar store versus Redis<a class="headerlink" href="#pulsar-store-versus-redis" title="Permalink to this headline">¶</a></h2>
<p>Benchmarking the pulsar store application versus redis is useful for
measuring the speed of the python event loop and parsing with respect
a superfast C implementation like redis.</p>
<p>First lunch the pulsar ds example:</p>
<div class="highlight-python"><div class="highlight"><pre>python manage.py
</pre></div>
</div>
<p>Than use the <tt class="docutils literal"><span class="pre">redis-benchmark</span></tt> executable, for example:</p>
<div class="highlight-python"><div class="highlight"><pre>./redis-benchmark -t set -n 1000000 -d 20 -c 100 -p 6410
</pre></div>
</div>
<p>Test the set command with 100 concurrent clients with a payload of 20 bytes,
1 million times.</p>
<p>Unsurprisingly, running the server with pypy will deliver much faster
(about four times) results.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo">
<a href="../index.html">
  <img class="logo" width="200" src="../static/pulsar-logo.svg" alt="pulsar" title="Pulsar"/>
</a>
</p>
<div class="g-plusone"></div>
<script type="text/javascript">
  window.___gcfg = {lang: 'en-GB'};
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<br>
<a href="https://twitter.com/share" class="twitter-share-button" data-size="large">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
<br>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Benchmarking</a><ul>
<li><a class="reference internal" href="#test-concurrency">Test Concurrency</a><ul>
<li><a class="reference internal" href="#test-streaming">Test streaming</a></li>
<li><a class="reference internal" href="#benchmark-with-jmeter">Benchmark with JMeter</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-slow-clients">Test slow clients</a></li>
<li><a class="reference internal" href="#pulsar-store-versus-redis">Pulsar store versus Redis</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="sync.html"
                        title="previous chapter">Synchronous Components</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="cextensions.html"
                        title="next chapter">C Extensions</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../sources/tutorials/benchmarking.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>


<div class="footer">
     &copy; Copyright 2011-2014, Luca Sbardella.
   Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.
 </div>


<script type="text/javascript">

  var _gaq = _gaq || [];
  
  _gaq.push(['_setAccount', 'UA-3900561-8']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>