

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Greenlet Support &mdash; pulsar 1.5.0 documentation</title>
    
    <link rel="stylesheet" href="../static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../static/pulsar.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <link rel="shortcut icon" href="../static/favicon.ico"/>
    <link rel="top" title="pulsar 1.5.0 documentation" href="../index.html" />
    <link rel="next" title="Test Suite" href="test.html" />
    <link rel="prev" title="Asynchronous HTTP client" href="http.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-pulsar.apps.greenio">
<span id="greenlet-support"></span><span id="greenio"></span><h1>Greenlet Support<a class="headerlink" href="#module-pulsar.apps.greenio" title="Permalink to this headline">¶</a></h1>
<p>Pulsar <code class="xref py py-mod docutils literal"><span class="pre">greenio</span></code> facilitates the integration of synchronous
third-party libraries into pulsar asynchronous framework.
It requires the <a class="reference external" href="http://greenlet.readthedocs.org/">greenlet</a> library.</p>
<p>If you want to understand how integration works but you are unfamiliar with
greenlets, check out the <a class="reference external" href="http://greenlet.readthedocs.org/">greenlet documentation</a> first.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="https://github.com/quantmind/pulsar-odm">pulsar-odm</a> is a separate library, maintained by the same authors of
pulsar, which provides asynchronous object data mapping with
<a class="reference external" href="https://docs.python.org/3/library/asyncio.html">asyncio</a> and <a class="reference external" href="http://www.sqlalchemy.org/">sqlalchemy</a> and uses pulsar greenio extensions.</p>
</div>
<p>This application <strong>does not use monkey patching</strong> and therefore it
works quite differently from implicit asynchronous libraries such as
<a class="reference external" href="http://www.gevent.org/">gevent</a>. This module provides the user with a set
of utilities for <strong>explicitly</strong> transferring execution from one greenlet
to another which executes the blocking call in a greenlet-friendly way.</p>
<p>The caller has the responsibility that the blocking call is greenlet-friendly,
i.e. it transfers the control of execution back to the parent greenlet when
needed.</p>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Lets assume you are building an application which uses pulsar asynchronous
engine and would like to</p>
<ul class="simple">
<li>either use an external library written in blocking style,
i.e. without yielding control to the event loop when IO calls are performed.</li>
<li>or write your client code without dealing with <a class="reference external" href="http://python.readthedocs.org/en/latest/library/asyncio-task.html#asyncio.Future" title="(in Python v3.6)"><code class="xref py py-class docutils literal"><span class="pre">Future</span></code></a> or
coroutines, in other words in an implicit asynchronous style. In this way
your client code can be used on other frameworks just as well.</li>
</ul>
<p>In both cases, the <a class="reference internal" href="#module-pulsar.apps.greenio" title="pulsar.apps.greenio"><code class="xref py py-class docutils literal"><span class="pre">greenio</span></code></a> application is what you need.</p>
<div class="section" id="green-wsgi">
<span id="id1"></span><h3>Green WSGI<a class="headerlink" href="#green-wsgi" title="Permalink to this headline">¶</a></h3>
<p>Assume you are using pulsar web server and would like to write your application
in an implicit asynchronous mode, i.e. without dealing with futures nor
coroutines, then you can wrap your WSGI <code class="docutils literal"><span class="pre">app</span></code> with the <a class="reference internal" href="#pulsar.apps.greenio.wsgi.GreenWSGI" title="pulsar.apps.greenio.wsgi.GreenWSGI"><code class="xref py py-class docutils literal"><span class="pre">GreenWSGI</span></code></a>
utility:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pulsar.apps.wsgi</span> <span class="kn">import</span> <span class="n">WSGIServer</span>
<span class="kn">from</span> <span class="nn">pulsar.apps.greenio</span> <span class="kn">import</span> <span class="n">GreenPool</span><span class="p">,</span> <span class="n">GreenWSGI</span>

<span class="n">green_pool</span> <span class="o">=</span> <span class="n">greenio</span><span class="o">.</span><span class="n">GreenPool</span><span class="p">()</span>
<span class="nb">callable</span> <span class="o">=</span> <span class="n">GreenWSGI</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">green_pool</span><span class="p">)</span>

<span class="n">WSGIServer</span><span class="p">(</span><span class="nb">callable</span><span class="o">=</span><span class="nb">callable</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#pulsar.apps.greenio.pool.GreenPool" title="pulsar.apps.greenio.pool.GreenPool"><code class="xref py py-class docutils literal"><span class="pre">GreenPool</span></code></a> manages a pool of greenlets which execute your
application. In this way, within your <code class="docutils literal"><span class="pre">app</span></code> you can invoke the
<a class="reference internal" href="#pulsar.apps.greenio.utils.wait" title="pulsar.apps.greenio.utils.wait"><code class="xref py py-func docutils literal"><span class="pre">wait()</span></code></a> function when needing to wait for asynchronous results to be
ready.</p>
</div>
<div class="section" id="greenhttp">
<span id="green-http"></span><h3>GreenHttp<a class="headerlink" href="#greenhttp" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="http.html#pulsar.apps.http.HttpClient" title="pulsar.apps.http.HttpClient"><code class="xref py py-class docutils literal"><span class="pre">HttpClient</span></code></a> can be used with greenlets:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pulsar.apps.greenio</span> <span class="kn">import</span> <span class="n">GreenHttp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">http</span> <span class="o">=</span> <span class="n">GreenHttp</span><span class="p">()</span>
</pre></div>
</div>
<p>And now you can write synchronous looking code and run it in a separate
greenlet via the <a class="reference internal" href="#pulsar.apps.greenio.utils.run_in_greenlet" title="pulsar.apps.greenio.utils.run_in_greenlet"><code class="xref py py-func docutils literal"><span class="pre">run_in_greenlet()</span></code></a> decorator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@greenio.run_in_greenlet</span>
<span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://bbc.co.uk&#39;</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</pre></div>
</div>
<p>and somewhere, in your asynchronous code:</p>
<div class="highlight-python"><div class="highlight"><pre>result = await example()
result == ...
</pre></div>
</div>
<p>the <a class="reference internal" href="#pulsar.apps.greenio.utils.run_in_greenlet" title="pulsar.apps.greenio.utils.run_in_greenlet"><code class="xref py py-func docutils literal"><span class="pre">run_in_greenlet()</span></code></a> decorator, execute the function on a child
greenlet without blocking the asynchronous engine. Once the <code class="docutils literal"><span class="pre">example</span></code>
function returns, the asynchronous code continue from the <code class="docutils literal"><span class="pre">yield</span></code>
statement as usual.</p>
</div>
</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="wait">
<h3>Wait<a class="headerlink" href="#wait" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="pulsar.apps.greenio.utils.wait">
<code class="descclassname">pulsar.apps.greenio.utils.</code><code class="descname">wait</code><span class="sig-paren">(</span><em>value</em>, <em>must_be_child=False</em><span class="sig-paren">)</span><a class="reference internal" href="../modules/pulsar/apps/greenio/utils.html#wait"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pulsar.apps.greenio.utils.wait" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for a possible asynchronous value to complete.</p>
</dd></dl>

</div>
<div class="section" id="run-in-greenlet">
<h3>Run in greenlet<a class="headerlink" href="#run-in-greenlet" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="pulsar.apps.greenio.utils.run_in_greenlet">
<code class="descclassname">pulsar.apps.greenio.utils.</code><code class="descname">run_in_greenlet</code><span class="sig-paren">(</span><em>callable</em><span class="sig-paren">)</span><a class="reference internal" href="../modules/pulsar/apps/greenio/utils.html#run_in_greenlet"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pulsar.apps.greenio.utils.run_in_greenlet" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to run a <code class="docutils literal"><span class="pre">callable</span></code> on a new greenlet.</p>
<p>A <code class="docutils literal"><span class="pre">callable</span></code> decorated with this decorator returns a coroutine</p>
</dd></dl>

</div>
<div class="section" id="green-pool">
<h3>Green Pool<a class="headerlink" href="#green-pool" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="pulsar.apps.greenio.pool.GreenPool">
<em class="property">class </em><code class="descclassname">pulsar.apps.greenio.pool.</code><code class="descname">GreenPool</code><span class="sig-paren">(</span><em>max_workers=None</em>, <em>loop=None</em><span class="sig-paren">)</span><a class="reference internal" href="../modules/pulsar/apps/greenio/pool.html#GreenPool"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pulsar.apps.greenio.pool.GreenPool" title="Permalink to this definition">¶</a></dt>
<dd><p>A pool of running greenlets.</p>
<p>This pool maintains a group of greenlets to perform asynchronous
tasks via the <code class="xref py py-meth docutils literal"><span class="pre">submit()</span></code> method.</p>
<dl class="attribute">
<dt id="pulsar.apps.greenio.pool.GreenPool.closed">
<code class="descname">closed</code><a class="headerlink" href="#pulsar.apps.greenio.pool.GreenPool.closed" title="Permalink to this definition">¶</a></dt>
<dd><p>True if this pool is closed and no task can queued</p>
</dd></dl>

<dl class="attribute">
<dt id="pulsar.apps.greenio.pool.GreenPool.in_green_worker">
<code class="descname">in_green_worker</code><a class="headerlink" href="#pulsar.apps.greenio.pool.GreenPool.in_green_worker" title="Permalink to this definition">¶</a></dt>
<dd><p>True if the current greenlet is a green pool worker</p>
</dd></dl>

<dl class="method">
<dt id="pulsar.apps.greenio.pool.GreenPool.submit">
<code class="descname">submit</code><span class="sig-paren">(</span><em>func</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../modules/pulsar/apps/greenio/pool.html#GreenPool.submit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pulsar.apps.greenio.pool.GreenPool.submit" title="Permalink to this definition">¶</a></dt>
<dd><p>Equivalent to <code class="docutils literal"><span class="pre">func(*args,</span> <span class="pre">**kwargs)</span></code>.</p>
<p>This method create a new task for function <code class="docutils literal"><span class="pre">func</span></code> and adds it to
the queue.
Return a <a class="reference external" href="http://python.readthedocs.org/en/latest/library/asyncio-task.html#asyncio.Future" title="(in Python v3.6)"><code class="xref py py-class docutils literal"><span class="pre">Future</span></code></a> called back once the task
has finished.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="green-lock">
<h3>Green Lock<a class="headerlink" href="#green-lock" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="pulsar.apps.greenio.lock.GreenLock">
<em class="property">class </em><code class="descclassname">pulsar.apps.greenio.lock.</code><code class="descname">GreenLock</code><span class="sig-paren">(</span><em>loop=None</em><span class="sig-paren">)</span><a class="reference internal" href="../modules/pulsar/apps/greenio/lock.html#GreenLock"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pulsar.apps.greenio.lock.GreenLock" title="Permalink to this definition">¶</a></dt>
<dd><p>A Locking primitive that is owned by a particular greenlet
when locked.The main greenlet cannot acquire the lock.</p>
<p>A primitive lock is in one of two states, &#8216;locked&#8217; or &#8216;unlocked&#8217;.</p>
<p>It is created in the unlocked state. It has two basic methods,
<a class="reference internal" href="../api/async.html#pulsar.async.lock.LockBase.acquire" title="pulsar.async.lock.LockBase.acquire"><code class="xref py py-meth docutils literal"><span class="pre">acquire()</span></code></a> and <code class="xref py py-meth docutils literal"><span class="pre">release.</span> <span class="pre">When</span> <span class="pre">the</span> <span class="pre">state</span> <span class="pre">is</span> <span class="pre">unlocked,</span>
<span class="pre">:meth:()</span></code>.acquire` changes the state to locked and returns immediately.</p>
<p>When the state is locked, <a class="reference internal" href="../api/async.html#pulsar.async.lock.LockBase.acquire" title="pulsar.async.lock.LockBase.acquire"><code class="xref py py-meth docutils literal"><span class="pre">acquire()</span></code></a> blocks the current greenlet
until a call to <a class="reference internal" href="#pulsar.apps.greenio.lock.GreenLock.release" title="pulsar.apps.greenio.lock.GreenLock.release"><code class="xref py py-meth docutils literal"><span class="pre">release()</span></code></a> changes it to unlocked,
then the <a class="reference internal" href="../api/async.html#pulsar.async.lock.LockBase.acquire" title="pulsar.async.lock.LockBase.acquire"><code class="xref py py-meth docutils literal"><span class="pre">acquire()</span></code></a> call resets it to locked and returns.</p>
<dl class="method">
<dt id="pulsar.apps.greenio.lock.GreenLock.locked">
<code class="descname">locked</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../modules/pulsar/apps/greenio/lock.html#GreenLock.locked"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pulsar.apps.greenio.lock.GreenLock.locked" title="Permalink to this definition">¶</a></dt>
<dd><p>&#8216;Return the greenlet that acquire the lock or None.</p>
</dd></dl>

<dl class="method">
<dt id="pulsar.apps.greenio.lock.GreenLock.acquire">
<code class="descname">acquire</code><span class="sig-paren">(</span><em>timeout=None</em><span class="sig-paren">)</span><a class="reference internal" href="../modules/pulsar/apps/greenio/lock.html#GreenLock.acquire"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pulsar.apps.greenio.lock.GreenLock.acquire" title="Permalink to this definition">¶</a></dt>
<dd><p>Acquires the lock if in the unlocked state otherwise switch
back to the parent coroutine.</p>
</dd></dl>

<dl class="method">
<dt id="pulsar.apps.greenio.lock.GreenLock.release">
<code class="descname">release</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../modules/pulsar/apps/greenio/lock.html#GreenLock.release"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pulsar.apps.greenio.lock.GreenLock.release" title="Permalink to this definition">¶</a></dt>
<dd><p>Release the lock.</p>
<p>This method should only be called in the locked state;
it changes the state to unlocked and returns immediately.
If an attempt is made to release an unlocked lock,
a RuntimeError will be raised.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id2">
<h3>Green WSGI<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="pulsar.apps.greenio.wsgi.GreenWSGI">
<em class="property">class </em><code class="descclassname">pulsar.apps.greenio.wsgi.</code><code class="descname">GreenWSGI</code><span class="sig-paren">(</span><em>middleware</em>, <em>pool</em>, <em>response_middleware=None</em><span class="sig-paren">)</span><a class="reference internal" href="../modules/pulsar/apps/greenio/wsgi.html#GreenWSGI"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pulsar.apps.greenio.wsgi.GreenWSGI" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps a WSGI application to be executed on a <a class="reference internal" href="#pulsar.apps.greenio.pool.GreenPool" title="pulsar.apps.greenio.pool.GreenPool"><code class="xref py py-class docutils literal"><span class="pre">GreenPool</span></code></a></p>
</dd></dl>

</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../static/pulsar-logo.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">Concurrent framework for python 3.5 and above.</p>



<p>
<iframe src="https://ghbtns.com/github-btn.html?user=quantmind&repo=pulsar&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>




<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advantage.html">Pulsar Advantage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials &amp; Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../settings.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgement.html">Acknowledgement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pics.html">Pics</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="socket.html">Socket Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="wsgi/index.html">WSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpc.html">JSON-RPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="websockets.html">WebSockets</a></li>
<li class="toctree-l1"><a class="reference internal" href="http.html">Asynchronous HTTP client</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Greenlet Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Test Suite</a></li>
<li class="toctree-l1"><a class="reference internal" href="ds.html">Pulsar Data Store Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="data/index.html">Data Stores</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011-2016, Luca Sbardella.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="../sources/apps/greenio.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-3900561-7']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>