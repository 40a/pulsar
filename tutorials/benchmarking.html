

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Benchmarking &#8212; pulsar 1.6.0b1 documentation</title>
    
    <link rel="stylesheet" href="../static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../static/pulsar.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.6.0b1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <link rel="shortcut icon" href="../static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="pulsar 1.6.0b1 documentation" href="../index.html" />
    <link rel="up" title="Tutorials &amp; Topics" href="index.html" />
    <link rel="next" title="C Extensions" href="cextensions.html" />
    <link rel="prev" title="Synchronous Components" href="sync.html" />
   
  <link rel="stylesheet" href="../static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="benchmarking">
<h1>Benchmarking<a class="headerlink" href="#benchmarking" title="Permalink to this headline">¶</a></h1>
<div class="section" id="test-concurrency">
<h2>Test Concurrency<a class="headerlink" href="#test-concurrency" title="Permalink to this headline">¶</a></h2>
<p>The simplest way to benchmark pulsar is to use the <a class="reference internal" href="httpbin.html#tutorials-httpbin"><span class="std std-ref">HttpBin</span></a>
example application. It is a web server responding to several urls:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">b</span> <span class="p">:</span><span class="mi">9060</span>
</pre></div>
</div>
<div class="section" id="test-streaming">
<h3>Test streaming<a class="headerlink" href="#test-streaming" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">stream</span></code> url simulates a streaming response of chunks of length given by the
first url parameter repeated by the second url parameter.</p>
<p>For example, this measure the download speed when streaming chunks of 4KB 1,048,576 times
for a total of 4GB of data:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">9060</span><span class="o">/</span><span class="n">stream</span><span class="o">/</span><span class="mi">4096</span><span class="o">/</span><span class="mi">1048576</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
  <span class="o">%</span> <span class="n">Total</span>    <span class="o">%</span> <span class="n">Received</span> <span class="o">%</span> <span class="n">Xferd</span>  <span class="n">Average</span> <span class="n">Speed</span>   <span class="n">Time</span>    <span class="n">Time</span>     <span class="n">Time</span>  <span class="n">Current</span>
                                 <span class="n">Dload</span>  <span class="n">Upload</span>   <span class="n">Total</span>   <span class="n">Spent</span>    <span class="n">Left</span>  <span class="n">Speed</span>
<span class="mi">100</span> <span class="mi">4096</span><span class="n">M</span>    <span class="mi">0</span> <span class="mi">4096</span><span class="n">M</span>    <span class="mi">0</span>     <span class="mi">0</span>  <span class="mf">87.8</span><span class="n">M</span>      <span class="mi">0</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>  <span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">46</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="mf">73.1</span><span class="n">M</span>
</pre></div>
</div>
<p>The download speed is relatively slow considering the test is on localhost.
However, when switching the two numbers:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">9060</span><span class="o">/</span><span class="n">stream</span><span class="o">/</span><span class="mi">1048576</span><span class="o">/</span><span class="mi">4096</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
  <span class="o">%</span> <span class="n">Total</span>    <span class="o">%</span> <span class="n">Received</span> <span class="o">%</span> <span class="n">Xferd</span>  <span class="n">Average</span> <span class="n">Speed</span>   <span class="n">Time</span>    <span class="n">Time</span>     <span class="n">Time</span>  <span class="n">Current</span>
                                 <span class="n">Dload</span>  <span class="n">Upload</span>   <span class="n">Total</span>   <span class="n">Spent</span>    <span class="n">Left</span>  <span class="n">Speed</span>
<span class="mi">100</span> <span class="mi">4096</span><span class="n">M</span>    <span class="mi">0</span> <span class="mi">4096</span><span class="n">M</span>    <span class="mi">0</span>     <span class="mi">0</span>   <span class="mi">658</span><span class="n">M</span>      <span class="mi">0</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>  <span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">06</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>  <span class="mi">673</span><span class="n">M</span>
</pre></div>
</div>
<p>We have a download speed almost 10 times higher. Why?</p>
<p>Because the iterator send large chunks to pulsar and the buffering is handled
by asyncio rather than the iterator and therefore it is much more efficient.
In other words the bigger the chunks the faster the transfer rate and
the more responsive (in term of concurrent connections) the server will be.</p>
</div>
<div class="section" id="benchmark-with-jmeter">
<h3>Benchmark with JMeter<a class="headerlink" href="#benchmark-with-jmeter" title="Permalink to this headline">¶</a></h3>
<p>Install <a class="reference external" href="http://jmeter.apache.org/">jmeter</a>, on a mac simply use <code class="docutils literal"><span class="pre">homebrew</span></code></p>
<blockquote>
<div>brew install jmeter</div></blockquote>
<p>launch it, open the <code class="docutils literal"><span class="pre">httpbin.jmx</span></code> benchmark file and run it.</p>
</div>
</div>
<div class="section" id="test-slow-clients">
<h2>Test slow clients<a class="headerlink" href="#test-slow-clients" title="Permalink to this headline">¶</a></h2>
<p>Testing pulsar with <a class="reference external" href="http://ha.ckers.org/slowloris/">slowloris</a> is a great way to check the performance under
low bandwidth yet greedy clients.</p>
<p>check the file limits with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ulimit</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
<p>and set:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ulimit</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1000</span>
</pre></div>
</div>
<p>Check <a class="reference external" href="http://ha.ckers.org/slowloris/">slowloris</a> usage with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">perldoc</span> <span class="n">slowloris</span><span class="o">.</span><span class="n">pl</span>
</pre></div>
</div>
<p>To test for slow bandwidth greedy clients:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">slowloris</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">dns</span> <span class="n">www</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="o">-</span><span class="n">port</span> <span class="mi">80</span> <span class="o">-</span><span class="n">timeout</span> <span class="mi">30</span> <span class="o">-</span><span class="n">num</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
<div class="section" id="pulsar-store-versus-redis">
<h2>Pulsar store versus Redis<a class="headerlink" href="#pulsar-store-versus-redis" title="Permalink to this headline">¶</a></h2>
<p>Benchmarking the pulsar store application versus redis is useful for
measuring the speed of the python event loop and parsing with respect
a superfast C implementation like redis.</p>
<p>First lunch the pulsar <code class="docutils literal"><span class="pre">ds</span></code> example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Than use the <code class="docutils literal"><span class="pre">redis-benchmark</span></code> executable, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">redis</span><span class="o">-</span><span class="n">benchmark</span> <span class="o">-</span><span class="n">t</span> <span class="nb">set</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1000000</span> <span class="o">-</span><span class="n">d</span> <span class="mi">20</span> <span class="o">-</span><span class="n">c</span> <span class="mi">100</span> <span class="o">-</span><span class="n">p</span> <span class="mi">6410</span>
</pre></div>
</div>
<p>Test the set command with 100 concurrent clients with a payload of 20 bytes,
1 million times.</p>
<p>Unsurprisingly, running the server with pypy will deliver much faster
(about four times) results.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../static/pulsar-logo.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">Concurrent framework for python 3.5 and above.</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=quantmind&repo=pulsar&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advantage.html">Pulsar Advantage</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials &amp; Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../settings.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgement.html">Acknowledgement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pics.html">Pics</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apps/socket.html">Socket Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/wsgi/index.html">WSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/rpc.html">JSON-RPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/websockets.html">WebSockets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/http.html">Asynchronous HTTP client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/greenio.html">Greenlet Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/test.html">Test Suite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/test.html#integration">Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/test.html#running-tests">Running Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/test.html#options">Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/test.html#test-plugins">Test Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/test.html#api">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/test.html#module-pulsar.apps.test.utils">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/ds.html">Pulsar Data Store Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/data/index.html">Data Stores</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011-2016, Luca Sbardella.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.8</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="../sources/tutorials/benchmarking.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-3900561-7']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>