<!DOCTYPE html>



<html>
<head>
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

    <title>pulsar.async.protocols &mdash; pulsar 0.8.4-beta.0 documentation</title>
    
    <link rel="stylesheet" href="../../../static/pulsar.css" type="text/css" />
    <link rel="stylesheet" href="../../../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.8.4-beta.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../static/jquery.js"></script>
    <script type="text/javascript" src="../../../static/underscore.js"></script>
    <script type="text/javascript" src="../../../static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../static/favicon.ico"/>
    <link rel="top" title="pulsar 0.8.4-beta.0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
</head>
 <body>



    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">pulsar 0.8.4-beta.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
<div class="deck">
<div class="header">
    
        <p class="developmentversion">
        Documentation for pulsar's DEVELOPMENT version. Get the
        <a href="http://pythonhosted.org/pulsar/modules/pulsar/async/protocols.html">release docs here</a>.
        </p>
    
</div>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pulsar.async.protocols</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">pulsar</span>
<span class="kn">from</span> <span class="nn">pulsar.utils.internet</span> <span class="kn">import</span> <span class="n">nice_address</span><span class="p">,</span> <span class="n">format_address</span>

<span class="kn">from</span> <span class="nn">.futures</span> <span class="kn">import</span> <span class="n">multi_async</span><span class="p">,</span> <span class="n">in_loop</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">coroutine_return</span>
<span class="kn">from</span> <span class="nn">.events</span> <span class="kn">import</span> <span class="n">EventHandler</span>
<span class="kn">from</span> <span class="nn">.access</span> <span class="kn">import</span> <span class="n">asyncio</span><span class="p">,</span> <span class="n">get_event_loop</span><span class="p">,</span> <span class="n">new_event_loop</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ProtocolConsumer&#39;</span><span class="p">,</span>
           <span class="s">&#39;Protocol&#39;</span><span class="p">,</span>
           <span class="s">&#39;DatagramProtocol&#39;</span><span class="p">,</span>
           <span class="s">&#39;Connection&#39;</span><span class="p">,</span>
           <span class="s">&#39;Producer&#39;</span><span class="p">,</span>
           <span class="s">&#39;TcpServer&#39;</span><span class="p">,</span>
           <span class="s">&#39;DatagramServer&#39;</span><span class="p">]</span>


<span class="n">BIG</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">31</span>


<div class="viewcode-block" id="ProtocolConsumer"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.ProtocolConsumer">[docs]</a><span class="k">class</span> <span class="nc">ProtocolConsumer</span><span class="p">(</span><span class="n">EventHandler</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;The consumer of data for a server or client :class:`Connection`.</span>

<span class="sd">    It is responsible for receiving incoming data from an end point via the</span>
<span class="sd">    :meth:`Connection.data_received` method, decoding (parsing) and,</span>
<span class="sd">    possibly, writing back to the client or server via</span>
<span class="sd">    the :attr:`transport` attribute.</span>

<span class="sd">    .. note::</span>

<span class="sd">        For server consumers, :meth:`data_received` is the only method</span>
<span class="sd">        to implement.</span>
<span class="sd">        For client consumers, :meth:`start_request` should also be implemented.</span>

<span class="sd">    A :class:`ProtocolConsumer` is a subclass of :class:`.EventHandler` and it</span>
<span class="sd">    has two default :ref:`one time events &lt;one-time-event&gt;`:</span>

<span class="sd">    * ``pre_request`` fired when the request is received (for servers) or</span>
<span class="sd">      just before is sent (for clients).</span>
<span class="sd">      This occurs just before the :meth:`start_request` method.</span>
<span class="sd">    * ``post_request`` fired when the request is done. The</span>
<span class="sd">      :attr:`on_finished` attribute is a shortcut for the ``post_request``</span>
<span class="sd">      :class:`.OneTime` event and therefore can be used to wait for</span>
<span class="sd">      the request to have received a full response (clients).</span>

<span class="sd">    In addition, it has two :ref:`many times events &lt;many-times-event&gt;`:</span>

<span class="sd">    * ``data_received`` fired when new data is received from the transport but</span>
<span class="sd">      not yet processed (before the :meth:`data_received` method is invoked)</span>
<span class="sd">    * ``data_processed`` fired just after data has been consumed (after the</span>
<span class="sd">      :meth:`data_received` method)</span>

<span class="sd">    .. note::</span>

<span class="sd">        A useful example on how to use the ``data_received`` event is</span>
<span class="sd">        the :ref:`wsgi proxy server &lt;tutorials-proxy-server&gt;`.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_connection</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_data_received_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ONE_TIME_EVENTS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;pre_request&#39;</span><span class="p">,</span> <span class="s">&#39;post_request&#39;</span><span class="p">)</span>
    <span class="n">MANY_TIMES_EVENTS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;data_received&#39;</span><span class="p">,</span> <span class="s">&#39;data_processed&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="ProtocolConsumer.connection"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.ProtocolConsumer.connection">[docs]</a>    <span class="k">def</span> <span class="nf">connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The :class:`Connection` of this consumer.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="ProtocolConsumer.request"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.ProtocolConsumer.request">[docs]</a>    <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The request.</span>

<span class="sd">        Used for clients only and available only after the</span>
<span class="sd">        :meth:`start` method is invoked.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_request&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="ProtocolConsumer.transport"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.ProtocolConsumer.transport">[docs]</a>    <span class="k">def</span> <span class="nf">transport</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The :class:`Transport` of this consumer&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">transport</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">address</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="ProtocolConsumer.producer"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.ProtocolConsumer.producer">[docs]</a>    <span class="k">def</span> <span class="nf">producer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The :class:`Producer` of this consumer.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">producer</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="ProtocolConsumer.on_finished"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.ProtocolConsumer.on_finished">[docs]</a>    <span class="k">def</span> <span class="nf">on_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The ``post_request`` one time event.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&#39;post_request&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ProtocolConsumer.connection_made"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.ProtocolConsumer.connection_made">[docs]</a>    <span class="k">def</span> <span class="nf">connection_made</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called by a :class:`Connection` when it starts using this consumer.</span>

<span class="sd">        By default it does nothing.</span>
<span class="sd">        &#39;&#39;&#39;</span>
</div>
<div class="viewcode-block" id="ProtocolConsumer.data_received"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.ProtocolConsumer.data_received">[docs]</a>    <span class="k">def</span> <span class="nf">data_received</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called when some data is received.</span>

<span class="sd">        **This method must be implemented by subclasses** for both server and</span>
<span class="sd">        client consumers.</span>

<span class="sd">        The argument is a bytes object.</span>
<span class="sd">        &#39;&#39;&#39;</span>
</div>
<div class="viewcode-block" id="ProtocolConsumer.start_request"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.ProtocolConsumer.start_request">[docs]</a>    <span class="k">def</span> <span class="nf">start_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Starts a new request.</span>

<span class="sd">        Invoked by the :meth:`start` method to kick start the</span>
<span class="sd">        request with remote server. For server :class:`ProtocolConsumer` this</span>
<span class="sd">        method is not invoked at all.</span>

<span class="sd">        **For clients this method should be implemented** and it is critical</span>
<span class="sd">        method where errors caused by stale socket connections can arise.</span>
<span class="sd">        **This method should not be called directly.** Use :meth:`start`</span>
<span class="sd">        instead. Typically one writes some data from the :attr:`request`</span>
<span class="sd">        into the transport. Something like this::</span>

<span class="sd">            self.transport.write(self.request.encode())</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="ProtocolConsumer.start"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.ProtocolConsumer.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Starts processing the request for this protocol consumer.</span>

<span class="sd">        There is no need to override this method,</span>
<span class="sd">        implement :meth:`start_request` instead.</span>
<span class="sd">        If either :attr:`connection` or :attr:`transport` are missing, a</span>
<span class="sd">        :class:`RuntimeError` occurs.</span>

<span class="sd">        For server side consumer, this method simply fires the ``pre_request``</span>
<span class="sd">        event.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_request&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Consumer already started&#39;</span><span class="p">)</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Cannot start new request. No connection.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">conn</span><span class="o">.</span><span class="n">_transport</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> has no transport.&#39;</span> <span class="o">%</span> <span class="n">conn</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">_processed</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">conn</span><span class="o">.</span><span class="n">_producer</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">_producer</span><span class="p">,</span> <span class="s">&#39;_requests_processed&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">_producer</span><span class="o">.</span><span class="n">_requests_processed</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind_event</span><span class="p">(</span><span class="s">&#39;post_request&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_request</span> <span class="o">=</span> <span class="n">request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fire_event</span><span class="p">(</span><span class="s">&#39;pre_request&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_request</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">(</span><span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ProtocolConsumer.connection_lost"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.ProtocolConsumer.connection_lost">[docs]</a>    <span class="k">def</span> <span class="nf">connection_lost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called by the :attr:`connection` when the transport is closed.</span>

<span class="sd">        By default it calls the :meth:`finished` method. It can be overwritten</span>
<span class="sd">        to handle the potential exception ``exc``.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ProtocolConsumer.finished"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.ProtocolConsumer.finished">[docs]</a>    <span class="k">def</span> <span class="nf">finished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fire the ``post_request`` event if it wasn&#39;t already fired.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&#39;post_request&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fired</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fire_event</span><span class="p">(</span><span class="s">&#39;post_request&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_data_received</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c"># Called by Connection, it updates the counters and invoke</span>
        <span class="c"># the high level data_received method which must be implemented</span>
        <span class="c"># by subclasses</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_request&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_received_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_received_count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fire_event</span><span class="p">(</span><span class="s">&#39;data_received&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_received</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fire_event</span><span class="p">(</span><span class="s">&#39;data_processed&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">_current_consumer</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_current_consumer</span> <span class="o">=</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="PulsarProtocol"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.PulsarProtocol">[docs]</a><span class="k">class</span> <span class="nc">PulsarProtocol</span><span class="p">(</span><span class="n">EventHandler</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A mixin class for both :class:`.Protocol` and</span>
<span class="sd">    :class:`.DatagramProtocol`.</span>

<span class="sd">    A :class:`PulsarProtocol` is an :class:`.EventHandler` which has</span>
<span class="sd">    two :ref:`one time events &lt;one-time-event&gt;`:</span>

<span class="sd">    * ``connection_made``</span>
<span class="sd">    * ``connection_lost``</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ONE_TIME_EVENTS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;connection_made&#39;</span><span class="p">,</span> <span class="s">&#39;connection_lost&#39;</span><span class="p">)</span>

    <span class="n">_transport</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_idle_timeout</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_address</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_type</span> <span class="o">=</span> <span class="s">&#39;server&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">producer</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PulsarProtocol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">session</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_producer</span> <span class="o">=</span> <span class="n">producer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind_event</span><span class="p">(</span><span class="s">&#39;connection_lost&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_timeout</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_address</span>
        <span class="k">if</span> <span class="n">address</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> session </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="p">,</span> <span class="n">nice_address</span><span class="p">(</span><span class="n">address</span><span class="p">),</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;&lt;pending&gt; session </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span>
    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="PulsarProtocol.session"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.PulsarProtocol.session">[docs]</a>    <span class="k">def</span> <span class="nf">session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Connection session number.</span>

<span class="sd">        Passed during initialisation by the :attr:`producer`.</span>
<span class="sd">        Usually an integer representing the number of separate connections</span>
<span class="sd">        the producer has processed at the time it created this</span>
<span class="sd">        :class:`Protocol`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="PulsarProtocol.transport"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.PulsarProtocol.transport">[docs]</a>    <span class="k">def</span> <span class="nf">transport</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The :ref:`transport &lt;asyncio-transport&gt;` for this protocol.</span>

<span class="sd">        Available once the :meth:`connection_made` is called.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="PulsarProtocol.sock"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.PulsarProtocol.sock">[docs]</a>    <span class="k">def</span> <span class="nf">sock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The socket of :attr:`transport`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">get_extra_info</span><span class="p">(</span><span class="s">&#39;socket&#39;</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="PulsarProtocol.address"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.PulsarProtocol.address">[docs]</a>    <span class="k">def</span> <span class="nf">address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The address of the :attr:`transport`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_address</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="PulsarProtocol.timeout"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.PulsarProtocol.timeout">[docs]</a>    <span class="k">def</span> <span class="nf">timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Number of seconds to keep alive this connection when idle.</span>

<span class="sd">        A value of ``0`` means no timeout.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The :attr:`transport` event loop.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">_loop</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="PulsarProtocol.producer"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.PulsarProtocol.producer">[docs]</a>    <span class="k">def</span> <span class="nf">producer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The producer of this :class:`Protocol`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_producer</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="PulsarProtocol.closed"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.PulsarProtocol.closed">[docs]</a>    <span class="k">def</span> <span class="nf">closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;``True`` if the :attr:`transport` is closed.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">_closing</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span> <span class="k">else</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="PulsarProtocol.close"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.PulsarProtocol.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Close by closing the :attr:`transport`.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PulsarProtocol.abort"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.PulsarProtocol.abort">[docs]</a>    <span class="k">def</span> <span class="nf">abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Abort by aborting the :attr:`transport`.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PulsarProtocol.connection_made"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.PulsarProtocol.connection_made">[docs]</a>    <span class="k">def</span> <span class="nf">connection_made</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transport</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sets the :attr:`transport`, fire the ``connection_made`` event</span>
<span class="sd">        and adds a :attr:`timeout` for idle connections.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_timeout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span> <span class="o">=</span> <span class="n">transport</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">get_extra_info</span><span class="p">(</span><span class="s">&#39;peername&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">addr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="s">&#39;client&#39;</span>
            <span class="n">addr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">get_extra_info</span><span class="p">(</span><span class="s">&#39;sockname&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_address</span> <span class="o">=</span> <span class="n">addr</span>
        <span class="c"># let everyone know we have a connection with endpoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fire_event</span><span class="p">(</span><span class="s">&#39;connection_made&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_idle_timeout</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PulsarProtocol.connection_lost"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.PulsarProtocol.connection_lost">[docs]</a>    <span class="k">def</span> <span class="nf">connection_lost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fires the ``connection_lost`` event.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fire_event</span><span class="p">(</span><span class="s">&#39;connection_lost&#39;</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PulsarProtocol.eof_received"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.PulsarProtocol.eof_received">[docs]</a>    <span class="k">def</span> <span class="nf">eof_received</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The socket was closed from the remote end&#39;&#39;&#39;</span>
</div>
<div class="viewcode-block" id="PulsarProtocol.set_timeout"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.PulsarProtocol.set_timeout">[docs]</a>    <span class="k">def</span> <span class="nf">set_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set a new :attr:`timeout` for this connection.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_timeout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_idle_timeout</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;session&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="p">,</span>
                      <span class="s">&#39;timeout&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="p">}</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;connection&#39;</span><span class="p">:</span> <span class="n">connection</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_producer</span><span class="p">:</span>
            <span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_producer</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">info</span>

    <span class="c">########################################################################</span>
    <span class="c">#    INTERNALS</span>
    <span class="k">def</span> <span class="nf">_timed_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Closed idle </span><span class="si">%s</span><span class="s">.&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_idle_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idle_timeout</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_idle_timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">call_later</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">_timed_out</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cancel_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idle_timeout</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_idle_timeout</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_idle_timeout</span> <span class="o">=</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="Protocol"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.Protocol">[docs]</a><span class="k">class</span> <span class="nc">Protocol</span><span class="p">(</span><span class="n">PulsarProtocol</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;An :class:`asyncio.Protocol` with :ref:`events &lt;event-handling&gt;`</span>
<span class="sd">    &#39;&#39;&#39;</span>

</div>
<div class="viewcode-block" id="DatagramProtocol"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.DatagramProtocol">[docs]</a><span class="k">class</span> <span class="nc">DatagramProtocol</span><span class="p">(</span><span class="n">PulsarProtocol</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">DatagramProtocol</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;An ``asyncio.DatagramProtocol`` with events`&#39;&#39;&#39;</span>

</div>
<div class="viewcode-block" id="Connection"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.Connection">[docs]</a><span class="k">class</span> <span class="nc">Connection</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A :class:`Protocol` to handle multiple TCP requests/responses.</span>

<span class="sd">    It is a class which acts as bridge between a</span>
<span class="sd">    :ref:`transport &lt;asyncio-transport&gt;` and a :class:`.ProtocolConsumer`.</span>
<span class="sd">    It routes data arriving from the transport to the</span>
<span class="sd">    :meth:`current_consumer`.</span>

<span class="sd">    .. attribute:: _consumer_factory</span>

<span class="sd">        A factory of :class:`.ProtocolConsumer`.</span>

<span class="sd">    .. attribute:: _processed</span>

<span class="sd">        number of separate requests processed.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_current_consumer</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumer_factory</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Connection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_consumer_factory</span> <span class="o">=</span> <span class="n">consumer_factory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind_event</span><span class="p">(</span><span class="s">&#39;connection_lost&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_lost</span><span class="p">)</span>

<div class="viewcode-block" id="Connection.current_consumer"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.Connection.current_consumer">[docs]</a>    <span class="k">def</span> <span class="nf">current_consumer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The :class:`ProtocolConsumer` currently handling incoming data.</span>

<span class="sd">        This instance will receive data when this connection get data</span>
<span class="sd">        from the :attr:`~Protocol.transport` via the :meth:`data_received`</span>
<span class="sd">        method.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_consumer</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_consumer</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_consumer</span>
</div>
    <span class="k">def</span> <span class="nf">set_consumer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumer</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_consumer</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;Consumer is not None&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_consumer</span> <span class="o">=</span> <span class="n">consumer</span>
        <span class="n">consumer</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">consumer</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span>
        <span class="n">consumer</span><span class="o">.</span><span class="n">connection_made</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Connection.data_received"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.Connection.data_received">[docs]</a>    <span class="k">def</span> <span class="nf">data_received</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Delegates handling of data to the :meth:`current_consumer`.</span>

<span class="sd">        Once done set a timeout for idle connections when a</span>
<span class="sd">        :attr:`~Protocol.timeout` is a positive number (of seconds).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_timeout</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">consumer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_consumer</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">consumer</span><span class="o">.</span><span class="n">_data_received</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_idle_timeout</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Connection.upgrade"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.Connection.upgrade">[docs]</a>    <span class="k">def</span> <span class="nf">upgrade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumer_factory</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Upgrade the :func:`_consumer_factory` callable.</span>

<span class="sd">        This method can be used when the protocol specification changes</span>
<span class="sd">        during a response (an example is a WebSocket request/response,</span>
<span class="sd">        or HTTP tunneling).</span>

<span class="sd">        This method adds a ``post_request`` callback to the</span>
<span class="sd">        :meth:`current_consumer` to build a new consumer with the new</span>
<span class="sd">        :func:`_consumer_factory`.</span>

<span class="sd">        :param consumer_factory: the new consumer factory (a callable</span>
<span class="sd">            accepting no parameters)</span>
<span class="sd">        :return: ``None``.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_consumer_factory</span> <span class="o">=</span> <span class="n">consumer_factory</span>
        <span class="n">consumer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_consumer</span>
        <span class="k">if</span> <span class="n">consumer</span><span class="p">:</span>
            <span class="n">consumer</span><span class="o">.</span><span class="n">bind_event</span><span class="p">(</span><span class="s">&#39;post_request&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_consumer</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_consumer</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Connection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;connection&#39;</span><span class="p">]</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;request_processed&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processed</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">info</span>

    <span class="k">def</span> <span class="nf">_build_consumer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">consumer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_producer</span><span class="o">.</span><span class="n">build_consumer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_consumer_factory</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_consumer</span><span class="p">(</span><span class="n">consumer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_connection_lost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;It performs these actions in the following order:</span>

<span class="sd">        * Fires the ``connection_lost`` :ref:`one time event &lt;one-time-event&gt;`</span>
<span class="sd">          if not fired before, with ``exc`` as event data.</span>
<span class="sd">        * Cancel the idle timeout if set.</span>
<span class="sd">        * Invokes the :meth:`ProtocolConsumer.connection_lost` method in the</span>
<span class="sd">          :meth:`current_consumer`.</span>
<span class="sd">          &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">conn</span><span class="o">.</span><span class="n">_current_consumer</span><span class="p">:</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">_current_consumer</span><span class="o">.</span><span class="n">connection_lost</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Producer"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.Producer">[docs]</a><span class="k">class</span> <span class="nc">Producer</span><span class="p">(</span><span class="n">EventHandler</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;An Abstract :class:`.EventHandler` class for all producers of</span>
<span class="sd">    connections.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_requests_processed</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_sessions</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">protocol_factory</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&#39;&#39;&#39;A callable producing protocols.</span>

<span class="sd">    The signature of the protocol factory callable must be::</span>

<span class="sd">        protocol_factory(session, producer, **params)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">loop</span> <span class="ow">or</span> <span class="n">get_event_loop</span><span class="p">()</span> <span class="ow">or</span> <span class="n">new_event_loop</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Producer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Producer.sessions"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.Producer.sessions">[docs]</a>    <span class="k">def</span> <span class="nf">sessions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Total number of protocols created by the :class:`Producer`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sessions</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Producer.requests_processed"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.Producer.requests_processed">[docs]</a>    <span class="k">def</span> <span class="nf">requests_processed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Total number of requests processed.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requests_processed</span>
</div>
<div class="viewcode-block" id="Producer.create_protocol"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.Producer.create_protocol">[docs]</a>    <span class="k">def</span> <span class="nf">create_protocol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create a new protocol via the :meth:`protocol_factory`</span>

<span class="sd">        This method increase the count of :attr:`sessions` and build</span>
<span class="sd">        the protocol passing ``self`` as the producer.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sessions</span> <span class="o">=</span> <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sessions</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol_factory</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span> <span class="n">producer</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Producer.build_consumer"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.Producer.build_consumer">[docs]</a>    <span class="k">def</span> <span class="nf">build_consumer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumer_factory</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Build a consumer for a protocol.</span>

<span class="sd">        This method can be used by protocols which handle several requests,</span>
<span class="sd">        for example the :class:`Connection` class.</span>

<span class="sd">        :param consumer_factory: consumer factory to use.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">consumer</span> <span class="o">=</span> <span class="n">consumer_factory</span><span class="p">()</span>
        <span class="n">consumer</span><span class="o">.</span><span class="n">copy_many_times_events</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">consumer</span>

</div></div>
<div class="viewcode-block" id="TcpServer"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.TcpServer">[docs]</a><span class="k">class</span> <span class="nc">TcpServer</span><span class="p">(</span><span class="n">Producer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A :class:`Producer` of server :class:`Connection` for TCP servers.</span>

<span class="sd">    .. attribute:: _server</span>

<span class="sd">        A :class:`.Server` managed by this Tcp wrapper.</span>

<span class="sd">        Available once the :meth:`start_serving` method has returned.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ONE_TIME_EVENTS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">,</span> <span class="s">&#39;stop&#39;</span><span class="p">)</span>
    <span class="n">MANY_TIMES_EVENTS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;connection_made&#39;</span><span class="p">,</span> <span class="s">&#39;pre_request&#39;</span><span class="p">,</span> <span class="s">&#39;post_request&#39;</span><span class="p">,</span>
                         <span class="s">&#39;connection_lost&#39;</span><span class="p">)</span>
    <span class="n">_server</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_started</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protocol_factory</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sockets</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_connections</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">keep_alive</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TcpServer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol_factory</span> <span class="o">=</span> <span class="n">protocol_factory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;address&#39;</span><span class="p">:</span> <span class="n">address</span><span class="p">,</span> <span class="s">&#39;sockets&#39;</span><span class="p">:</span> <span class="n">sockets</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_connections</span> <span class="o">=</span> <span class="n">max_connections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keep_alive</span> <span class="o">=</span> <span class="n">keep_alive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_concurrent_connections</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span>
        <span class="k">if</span> <span class="n">address</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
    <span class="n">__str_</span> <span class="o">=</span> <span class="n">__repr__</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="TcpServer.address"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.TcpServer.address">[docs]</a>    <span class="k">def</span> <span class="nf">address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Socket address of this server.</span>

<span class="sd">        It is obtained from the first socket ``getsockname`` method.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">sockets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()</span>
</div>
    <span class="nd">@task</span>
<div class="viewcode-block" id="TcpServer.start_serving"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.TcpServer.start_serving">[docs]</a>    <span class="k">def</span> <span class="nf">start_serving</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backlog</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">sslcontext</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Start serving.</span>

<span class="sd">        :param backlog: Number of maximum connections</span>
<span class="sd">        :param sslcontext: optional SSLContext object.</span>
<span class="sd">        :return: a :class:`.Future` called back when the server is</span>
<span class="sd">            serving the socket.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_params&#39;</span><span class="p">):</span>
            <span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s">&#39;address&#39;</span><span class="p">]</span>
            <span class="n">sockets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s">&#39;sockets&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span>
            <span class="n">create_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">create_server</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sockets</span><span class="p">:</span>
                    <span class="n">server</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="k">for</span> <span class="n">sock</span> <span class="ow">in</span> <span class="n">sockets</span><span class="p">:</span>
                        <span class="n">srv</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">create_server</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_protocol</span><span class="p">,</span>
                                                  <span class="n">sock</span><span class="o">=</span><span class="n">sock</span><span class="p">,</span>
                                                  <span class="n">backlog</span><span class="o">=</span><span class="n">backlog</span><span class="p">,</span>
                                                  <span class="n">ssl</span><span class="o">=</span><span class="n">sslcontext</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">server</span><span class="p">:</span>
                            <span class="n">server</span><span class="o">.</span><span class="n">sockets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">srv</span><span class="o">.</span><span class="n">sockets</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">server</span> <span class="o">=</span> <span class="n">srv</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                        <span class="n">server</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">create_server</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_protocol</span><span class="p">,</span>
                                                     <span class="n">host</span><span class="o">=</span><span class="n">address</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="n">port</span><span class="o">=</span><span class="n">address</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                     <span class="n">backlog</span><span class="o">=</span><span class="n">backlog</span><span class="p">,</span>
                                                     <span class="n">ssl</span><span class="o">=</span><span class="n">sslcontext</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="o">=</span> <span class="n">server</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">sock</span> <span class="ow">in</span> <span class="n">server</span><span class="o">.</span><span class="n">sockets</span><span class="p">:</span>
                    <span class="n">address</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> serving on </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                                     <span class="n">format_address</span><span class="p">(</span><span class="n">address</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fire_event</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fire_event</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TcpServer.stop_serving"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.TcpServer.stop_serving">[docs]</a>    <span class="k">def</span> <span class="nf">stop_serving</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Stop serving the :attr:`.Server.sockets`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="p">:</span>
            <span class="n">server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="p">,</span> <span class="bp">None</span>
            <span class="n">server</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
    <span class="nd">@task</span>
<div class="viewcode-block" id="TcpServer.close"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.TcpServer.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Stop serving the :attr:`.Server.sockets` and close all</span>
<span class="sd">        concurrent connections.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fired_event</span><span class="p">(</span><span class="s">&#39;stop&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="p">:</span>
                <span class="n">server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="p">,</span> <span class="bp">None</span>
                <span class="n">server</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">yield</span> <span class="bp">None</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_close_connections</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fire_event</span><span class="p">(</span><span class="s">&#39;stop&#39;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sockets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">up</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_started</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">server</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;pulsar_version&#39;</span><span class="p">:</span> <span class="n">pulsar</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
                  <span class="s">&#39;python_version&#39;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                  <span class="s">&#39;uptime_in_seconds&#39;</span><span class="p">:</span> <span class="n">up</span><span class="p">,</span>
                  <span class="s">&#39;sockets&#39;</span><span class="p">:</span> <span class="n">sockets</span><span class="p">,</span>
                  <span class="s">&#39;max_connections&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_connections</span><span class="p">,</span>
                  <span class="s">&#39;keep_alive&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_alive</span><span class="p">}</span>
        <span class="n">clients</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;processed_clients&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sessions</span><span class="p">,</span>
                   <span class="s">&#39;connected_clients&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_concurrent_connections</span><span class="p">),</span>
                   <span class="s">&#39;requests_processed&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requests_processed</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sock</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">sockets</span><span class="p">:</span>
                <span class="n">sockets</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s">&#39;address&#39;</span><span class="p">:</span> <span class="n">format_address</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">getsockname</span><span class="p">())})</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&#39;server&#39;</span><span class="p">:</span> <span class="n">server</span><span class="p">,</span>
                <span class="s">&#39;clients&#39;</span><span class="p">:</span> <span class="n">clients</span><span class="p">}</span>

<div class="viewcode-block" id="TcpServer.create_protocol"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.TcpServer.create_protocol">[docs]</a>    <span class="k">def</span> <span class="nf">create_protocol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Override :meth:`Producer.create_protocol`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sessions</span> <span class="o">=</span> <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sessions</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">protocol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol_factory</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                                         <span class="n">producer</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_keep_alive</span><span class="p">)</span>
        <span class="n">protocol</span><span class="o">.</span><span class="n">bind_event</span><span class="p">(</span><span class="s">&#39;connection_made&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_made</span><span class="p">)</span>
        <span class="n">protocol</span><span class="o">.</span><span class="n">bind_event</span><span class="p">(</span><span class="s">&#39;connection_lost&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_lost</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_connections</span> <span class="ow">and</span>
                <span class="n">session</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_connections</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Reached maximum number of connections </span><span class="si">%s</span><span class="s">. &#39;</span>
                             <span class="s">&#39;Stop serving.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_connections</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">protocol</span>

    <span class="c">#    INTERNALS</span></div>
    <span class="k">def</span> <span class="nf">_connection_made</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_concurrent_connections</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_connection_lost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_concurrent_connections</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_close_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Close ``connection`` if specified, otherwise close all connections.</span>

<span class="sd">        Return a list of :class:`.Future` called back once the connection/s</span>
<span class="sd">        are closed.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">all</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
            <span class="nb">all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&#39;connection_lost&#39;</span><span class="p">))</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">connections</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_concurrent_connections</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_concurrent_connections</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="n">connections</span><span class="p">:</span>
                <span class="nb">all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">&#39;connection_lost&#39;</span><span class="p">))</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> closing </span><span class="si">%d</span><span class="s"> connections&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">all</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">multi_async</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="DatagramServer"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.DatagramServer">[docs]</a><span class="k">class</span> <span class="nc">DatagramServer</span><span class="p">(</span><span class="n">EventHandler</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;An :class:`.EventHandler` for serving UDP sockets.</span>

<span class="sd">    .. attribute:: _transports</span>

<span class="sd">        A list of :class:`.DatagramTransport`.</span>

<span class="sd">        Available once the :meth:`create_endpoint` method has returned.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_transports</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_started</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">ONE_TIME_EVENTS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">,</span> <span class="s">&#39;stop&#39;</span><span class="p">)</span>
    <span class="n">MANY_TIMES_EVENTS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;pre_request&#39;</span><span class="p">,</span> <span class="s">&#39;post_request&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protocol_factory</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sockets</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_requests</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">loop</span> <span class="ow">or</span> <span class="n">get_event_loop</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DatagramServer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol_factory</span> <span class="o">=</span> <span class="n">protocol_factory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_requests</span> <span class="o">=</span> <span class="n">max_requests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_requests_processed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;address&#39;</span><span class="p">:</span> <span class="n">address</span><span class="p">,</span> <span class="s">&#39;sockets&#39;</span><span class="p">:</span> <span class="n">sockets</span><span class="p">}</span>

    <span class="nd">@task</span>
<div class="viewcode-block" id="DatagramServer.create_endpoint"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.DatagramServer.create_endpoint">[docs]</a>    <span class="k">def</span> <span class="nf">create_endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;create the server endpoint.</span>

<span class="sd">        :return: a :class:`~asyncio.Future` called back when the server is</span>
<span class="sd">            serving the socket.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_params&#39;</span><span class="p">):</span>
            <span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s">&#39;address&#39;</span><span class="p">]</span>
            <span class="n">sockets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s">&#39;sockets&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">transports</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">sockets</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">transport</span> <span class="ow">in</span> <span class="n">sockets</span><span class="p">:</span>
                        <span class="n">proto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_protocol</span><span class="p">()</span>
                        <span class="n">transports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transport</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="p">,</span> <span class="n">proto</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">transport</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">create_datagram_endpoint</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">protocol_factory</span><span class="p">,</span> <span class="n">local_addr</span><span class="o">=</span><span class="n">adress</span><span class="p">)</span>
                    <span class="n">transports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_transports</span> <span class="o">=</span> <span class="n">transports</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">transport</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transports</span><span class="p">:</span>
                    <span class="n">address</span> <span class="o">=</span> <span class="n">transport</span><span class="o">.</span><span class="n">get_extra_info</span><span class="p">(</span><span class="s">&#39;sockname&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> serving on </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                                     <span class="n">format_address</span><span class="p">(</span><span class="n">address</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fire_event</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s">&#39;Error while starting UDP server&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fire_event</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fire_event</span><span class="p">(</span><span class="s">&#39;stop&#39;</span><span class="p">)</span>
</div>
    <span class="nd">@in_loop</span>
<div class="viewcode-block" id="DatagramServer.close"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.DatagramServer.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Stop serving the :attr:`.Server.sockets` and close all</span>
<span class="sd">        concurrent connections.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fired_event</span><span class="p">(</span><span class="s">&#39;stop&#39;</span><span class="p">):</span>
            <span class="n">transports</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transports</span><span class="p">,</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">transports</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">transport</span> <span class="ow">in</span> <span class="n">transports</span><span class="p">:</span>
                    <span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fire_event</span><span class="p">(</span><span class="s">&#39;stop&#39;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sockets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">up</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_started</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">server</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;pulsar_version&#39;</span><span class="p">:</span> <span class="n">pulsar</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
                  <span class="s">&#39;python_version&#39;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                  <span class="s">&#39;uptime_in_seconds&#39;</span><span class="p">:</span> <span class="n">up</span><span class="p">,</span>
                  <span class="s">&#39;sockets&#39;</span><span class="p">:</span> <span class="n">sockets</span><span class="p">,</span>
                  <span class="s">&#39;max_requests&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_requests</span><span class="p">}</span>
        <span class="n">clients</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;requests_processed&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requests_processed</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transports</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">transport</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transports</span><span class="p">:</span>
                <span class="n">sockets</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s">&#39;address&#39;</span><span class="p">:</span> <span class="n">format_address</span><span class="p">(</span><span class="n">transport</span><span class="o">.</span><span class="n">_sock</span><span class="o">.</span><span class="n">getsockname</span><span class="p">())})</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&#39;server&#39;</span><span class="p">:</span> <span class="n">server</span><span class="p">,</span>
                <span class="s">&#39;clients&#39;</span><span class="p">:</span> <span class="n">clients</span><span class="p">}</span>

<div class="viewcode-block" id="DatagramServer.create_protocol"><a class="viewcode-back" href="../../../api/protocols.html#pulsar.async.protocols.DatagramServer.create_protocol">[docs]</a>    <span class="k">def</span> <span class="nf">create_protocol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Override :meth:`Producer.create_protocol`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol_factory</span><span class="p">(</span><span class="n">producer</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo">
<a href="../../../index.html">
  <img class="logo" width="200" src="../../../static/pulsar.png" alt="pulsar" title="Pulsar"/>
</a>
</p>
<div class="g-plusone"></div>
<script type="text/javascript">
  window.___gcfg = {lang: 'en-GB'};
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<br>
<a href="https://twitter.com/share" class="twitter-share-button" data-size="large">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
<br>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>


<div class="footer">
     &copy; Copyright 2011-2014, Luca Sbardella.
   Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2b1.
 </div>


<script type="text/javascript">

  var _gaq = _gaq || [];
  
  _gaq.push(['_setAccount', 'UA-3900561-8']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>